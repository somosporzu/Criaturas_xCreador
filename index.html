<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Criaturas - Sistema PAPA</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        const CreatureCreator = () => {
          const [name, setName] = useState('');
          const [nd, setND] = useState('1');
          const [size, setSize] = useState('mediano');
          const [category, setCategory] = useState('bestias');
          const [tag, setTag] = useState('');
          const [concept, setConcept] = useState('');
          const [nature, setNature] = useState('');
          const [description, setDescription] = useState('');
          const [selectedTraits, setSelectedTraits] = useState([]);
          const [notification, setNotification] = useState(null);
          const [openCategory, setOpenCategory] = useState(null);
          const [cuerpoMod, setCuerpoMod] = useState(0);
          const [destrezaMod, setDestrezaMod] = useState(0);
          const [auraMod, setAuraMod] = useState(0);
          const [equipment, setEquipment] = useState([]);
          const [openEquipmentCategory, setOpenEquipmentCategory] = useState(null);
          const [customActions, setCustomActions] = useState([
            { id: 1, name: 'Dientes y Garras', damage: 'ND', type: 'Contundente', properties: 'Ataque natural', isNatural: true }
          ]);

          const ndStats = {
            '1/8': { resistencia: 4, defensa: 7, atributos: 0, danoBase: '1d6-3', pr: 0 },
            '1/4': { resistencia: 7, defensa: 8, atributos: 0, danoBase: '1d6-2', pr: 1 },
            '1/2': { resistencia: 12, defensa: 8, atributos: 1, danoBase: '1d6-1', pr: 1 },
            '1': { resistencia: 17, defensa: 8, atributos: 2, danoBase: '1d6', pr: 2 },
            '2': { resistencia: 27, defensa: 8, atributos: 3, danoBase: '1d6+1', pr: 3 },
            '3': { resistencia: 37, defensa: 9, atributos: 4, danoBase: '2d6-1', pr: 4 },
            '4': { resistencia: 52, defensa: 9, atributos: 4, danoBase: '2d6', pr: 5 },
            '5': { resistencia: 67, defensa: 10, atributos: 5, danoBase: '2d6+1', pr: 6 },
            '6': { resistencia: 72, defensa: 10, atributos: 5, danoBase: '2d6+2', pr: 7 },
            '7': { resistencia: 82, defensa: 11, atributos: 6, danoBase: '2d6+2', pr: 8 },
            '8': { resistencia: 92, defensa: 11, atributos: 6, danoBase: '2d6+3', pr: 9 },
            '9': { resistencia: 102, defensa: 12, atributos: 7, danoBase: '3d6', pr: 10 },
            '10': { resistencia: 112, defensa: 12, atributos: 7, danoBase: '3d6+1', pr: 10 },
            '11': { resistencia: 122, defensa: 12, atributos: 7, danoBase: '3d6+1', pr: 11 },
            '12': { resistencia: 132, defensa: 13, atributos: 8, danoBase: '3d6+2', pr: 11 },
            '13': { resistencia: 142, defensa: 13, atributos: 8, danoBase: '4d6', pr: 12 },
            '14': { resistencia: 152, defensa: 14, atributos: 9, danoBase: '4d6+1', pr: 13 },
            '15': { resistencia: 162, defensa: 14, atributos: 9, danoBase: '4d6+2', pr: 14 }
          };

          const sizeModifiers = {
            minusculo: { resistencia: -5, defensa: 3, label: 'Minúsculo' },
            pequeno: { resistencia: -5, defensa: 1, label: 'Pequeño' },
            mediano: { resistencia: 0, defensa: 0, label: 'Mediano' },
            grande: { resistencia: 15, defensa: -1, label: 'Grande' },
            enorme: { resistencia: 30, defensa: -2, label: 'Enorme' },
            colosal: { resistencia: 60, defensa: -4, label: 'Colosal' }
          };

          const traits = {
            'Atributos y Vitalidad': [
              { name: 'Deficiencia de Atributo', cost: -1, desc: 'Reduce en -1 un Atributo Primario' },
              { name: 'Mejora de Atributo', cost: 2, desc: 'Aumenta en +1 un Atributo Primario' },
              { name: 'Versatilidad Conceptual', cost: 2, desc: 'Aprende un nuevo Concepto' },
              { name: 'Versatilidad de Carácter', cost: 1, desc: 'Aprende una nueva Naturaleza' },
              { name: 'Vitalidad Aumentada', cost: 1, desc: '+10 Resistencia máxima' }
            ],
            'Ofensivos': [
              { name: 'Alcance Mejorado', cost: 1, desc: 'Alcance +3m' },
              { name: 'Ataque Adicional', cost: 1, desc: 'Segundo ataque sin bono' },
              { name: 'Ataque Poderoso', cost: 1, desc: '-2 ataque, +3 daño' },
              { name: 'Carga Imparable', cost: 1, desc: '+1d6 tras 5m rectos' },
              { name: 'Crítico Mejorado', cost: 2, desc: 'Crítico con 5-6' },
              { name: 'Drenaje', cost: 3, desc: 'Recupera daño como resistencia' },
              { name: 'Furia', cost: 2, desc: '+1d6 con ≤50% Resistencia' },
              { name: 'Sangrado', cost: 1, desc: 'Objetivo sufre 1d6 en turno' }
            ],
            'Defensivos': [
              { name: 'Armadura Natural', cost: 1, desc: '+1 Defensa' },
              { name: 'Corazón Doble', cost: 3, desc: 'A 0 queda con mitad' },
              { name: 'Escurridizo', cost: 1, desc: 'Sin ataques de oportunidad' },
              { name: 'Inmune', cost: 2, desc: 'Inmune a tipo de daño' },
              { name: 'Piel Gruesa', cost: 1, desc: 'Ignora 1 daño' },
              { name: 'Regeneración Mayor', cost: 2, desc: 'Recupera 5 al inicio' },
              { name: 'Resistente', cost: 1, desc: 'Resistencia a daño' },
              { name: 'Vulnerable', cost: -2, desc: 'Vulnerable a daño' }
            ],
            'Movilidad': [
              { name: 'Anfibio', cost: 1, desc: 'Respira aire y agua' },
              { name: 'Iniciativa Mejorada', cost: 1, desc: '+3 iniciativa' },
              { name: 'Movimiento Especial', cost: 1, desc: 'Nadar/Trepar/Excavar' },
              { name: 'Pies Ligeros', cost: 1, desc: 'Ignora terreno difícil' },
              { name: 'Velocidad Mejorada', cost: 1, desc: '+3m velocidad' },
              { name: 'Vuelo', cost: 2, desc: 'Velocidad de vuelo' }
            ],
            'Aura y Percepción': [
              { name: 'Aura de Miedo', cost: 3, desc: 'Asustado a 5m' },
              { name: 'Sentido Ciego', cost: 2, desc: 'Ve sin ojos 10m' },
              { name: 'Sentidos Agudos', cost: 1, desc: 'Ventaja en percepción' },
              { name: 'Visión en Oscuridad', cost: 1, desc: 'Ve en oscuridad' }
            ],
            'Control y Únicos': [
              { name: 'Jefe Solitario', cost: 3, desc: 'Acción Rápida extra' },
              { name: 'Resistencia Legendaria', cost: 2, desc: 'Supera 1 Salvación' }
            ]
          };

          const weapons = {
            'Simples Cuerpo a Cuerpo': [
              { name: 'Arma Improvisada', damage: '1d6-3', type: 'Variable', properties: '-' },
              { name: 'Daga/Cuchillo', damage: '1d6-2', type: 'Penetrante', properties: 'Ligera, Arrojadiza (5/10)' },
              { name: 'Bastón', damage: '1d6-1', type: 'Contundente', properties: 'A dos manos' },
              { name: 'Maza Ligera', damage: '1d6', type: 'Contundente', properties: 'Ligera' },
              { name: 'Hoz', damage: '1d6-1', type: 'Cortante', properties: 'Ligera' },
              { name: 'Lanza Corta', damage: '1d6', type: 'Penetrante', properties: 'Arrojadiza (10/20)' }
            ],
            'Marciales Cuerpo a Cuerpo': [
              { name: 'Espada Corta', damage: '1d6', type: 'Cortante', properties: 'Ligera' },
              { name: 'Hacha de Mano', damage: '1d6', type: 'Cortante', properties: 'Ligera, Arrojadiza (5/10)' },
              { name: 'Estoque', damage: '1d6', type: 'Penetrante', properties: 'Ligera' },
              { name: 'Lanza', damage: '1d6+1', type: 'Penetrante', properties: 'Versátil (2d6-1), Alcance' },
              { name: 'Espada Larga', damage: '1d6+1', type: 'Cortante', properties: 'Versátil (2d6)' },
              { name: 'Martillo de Guerra', damage: '1d6+1', type: 'Contundente', properties: 'Versátil (2d6)' },
              { name: 'Maza Pesada', damage: '2d6-1', type: 'Contundente', properties: 'Pesada' },
              { name: 'Alabarda', damage: '2d6', type: 'Cortante/Penetrante', properties: 'Pesada, A dos manos, Alcance' },
              { name: 'Mandoble', damage: '2d6', type: 'Cortante', properties: 'Pesada, A dos manos' },
              { name: 'Gran Hacha', damage: '2d6+1', type: 'Cortante', properties: 'Pesada, A dos manos' }
            ],
            'Armas a Distancia': [
              { name: 'Honda', damage: '1d6-2', type: 'Contundente', properties: 'Rango (15/30)' },
              { name: 'Arco Corto', damage: '1d6', type: 'Penetrante', properties: 'A dos manos, Rango (20/40)' },
              { name: 'Ballesta Ligera', damage: '1d6+1', type: 'Penetrante', properties: 'A dos manos, Rango (25/50), Recarga' },
              { name: 'Arco Largo', damage: '1d6+1', type: 'Penetrante', properties: 'Pesada, A dos manos, Rango (35/70)' },
              { name: 'Ballesta Pesada', damage: '2d6', type: 'Penetrante', properties: 'Pesada, A dos manos, Rango (40/80), Recarga' }
            ]
          };

          const armors = [
            { name: 'Sin Armadura', bonus: 0, dexLimit: 99, properties: '-' },
            { name: 'Ropas Acolchadas', bonus: 2, dexLimit: 99, properties: 'Ligera' },
            { name: 'Armadura de Cuero', bonus: 3, dexLimit: 99, properties: 'Ligera' },
            { name: 'Gambesón Reforzado', bonus: 3, dexLimit: 99, properties: 'Ligera, Sigilo -1' },
            { name: 'Cota de Mallas', bonus: 4, dexLimit: 2, properties: 'Media, Sigilo -1' },
            { name: 'Armadura de Escamas', bonus: 5, dexLimit: 2, properties: 'Media, Sigilo -2' },
            { name: 'Armadura de Placas', bonus: 6, dexLimit: 1, properties: 'Pesada, Sigilo -3' },
            { name: 'Armadura Completa', bonus: 7, dexLimit: 0, properties: 'Pesada, Sigilo -4' }
          ];

          const shields = [
            { name: 'Sin Escudo', bonus: 0, properties: '-' },
            { name: 'Broquel', bonus: 1, properties: 'Ligero' },
            { name: 'Rodela Pequeña', bonus: 2, properties: 'Ligero, Sigilo -1' },
            { name: 'Escudo Redondo', bonus: 2, properties: 'Medio, Sigilo -1' },
            { name: 'Escudo Estándar', bonus: 3, properties: 'Medio, Sigilo -2' },
            { name: 'Escudo Grande', bonus: 3, properties: 'Pesado, Sigilo -3' },
            { name: 'Escudo de Torre', bonus: 4, properties: 'Pesado, Sigilo -3' }
          ];

          const naturalezas = [
            'Alegremente', 'Apasionadamente', 'Astutamente', 'Brutalmente', 'Caóticamente',
            'Carismáticamente', 'Cautelosamente', 'Curiosamente', 'Despiadadamente', 'Discretamente',
            'Elegantemente', 'Fríamente', 'Impulsivamente', 'Inestablemente', 'Metódicamente',
            'Rápidamente', 'Silenciosamente', 'Siniestramente', 'Sutilmente', 'Tenazmente',
            'Torpemente', 'Valientemente'
          ];

          const addTrait = (trait) => {
            setSelectedTraits([...selectedTraits, { ...trait, id: Date.now() }]);
          };

          const removeTrait = (id) => {
            setSelectedTraits(selectedTraits.filter(t => t.id !== id));
          };

          const addEquipment = (item, type) => {
            setEquipment([...equipment, { ...item, type, id: Date.now() }]);
          };

          const removeEquipment = (id) => {
            setEquipment(equipment.filter(e => e.id !== id));
          };

          const addCustomAction = () => {
            setCustomActions([...customActions, { 
              id: Date.now(), 
              name: '', 
              damage: '', 
              type: 'Contundente', 
              properties: '',
              isNatural: false
            }]);
          };

          const updateCustomAction = (id, field, value) => {
            setCustomActions(customActions.map(action => 
              action.id === id ? { ...action, [field]: value } : action
            ));
          };

          const removeCustomAction = (id) => {
            setCustomActions(customActions.filter(action => action.id !== id));
          };

          const calculateStats = () => {
            const baseStats = ndStats[nd];
            const sizeMods = sizeModifiers[size];
            const traitPR = selectedTraits.reduce((sum, t) => sum + t.cost, 0);
            
            const attrModCost = (cuerpoMod * 2) + (destrezaMod * 2) + (auraMod * 2);
            
            const cuerpoFinal = baseStats.atributos + cuerpoMod;
            const destrezaFinal = baseStats.atributos + destrezaMod;
            const auraFinal = baseStats.atributos + auraMod;
            
            const selectedArmor = equipment.find(e => e.type === 'armor') || armors[0];
            const selectedShield = equipment.find(e => e.type === 'shield') || shields[0];
            
            const armorBonus = selectedArmor?.bonus || 0;
            const shieldBonus = selectedShield?.bonus || 0;
            const dexLimit = selectedArmor?.dexLimit !== undefined ? selectedArmor.dexLimit : 99;
            const effectiveDexBonus = Math.min(destrezaFinal, dexLimit);
            
            const defensa = 5 + effectiveDexBonus + armorBonus + shieldBonus + sizeMods.defensa;
            const iniciativa = destrezaFinal + auraFinal - 2;
            const movimiento = 9 + Math.max(0, destrezaFinal);
            
            return {
              resistencia: baseStats.resistencia + sizeMods.resistencia,
              defensa: defensa,
              cuerpo: cuerpoFinal,
              destreza: destrezaFinal,
              aura: auraFinal,
              iniciativa: iniciativa,
              movimiento: movimiento,
              danoBase: baseStats.danoBase,
              prBase: baseStats.pr,
              prUsed: traitPR + attrModCost,
              prRemaining: baseStats.pr - traitPR - attrModCost
            };
          };

          const exportAsText = () => {
            const stats = calculateStats();
            const selectedArmor = equipment.find(e => e.type === 'armor');
            const selectedShield = equipment.find(e => e.type === 'shield');
            const weaponEquipment = equipment.filter(e => e.type === 'weapon');
            
            let text = '#' + name.toUpperCase() + '\n';
            text += category.charAt(0).toUpperCase() + category.slice(1);
            if (tag) text += ' (' + tag + ')';
            text += ' ' + sizeModifiers[size].label + '; ND ' + nd + '\n\n';
            
            text += '## Estadísticas\n';
            text += 'Resistencia: ' + stats.resistencia + '\n';
            text += 'Defensa: ' + stats.defensa + '\n';
            text += 'Cuerpo: ' + (stats.cuerpo >= 0 ? '+' : '') + stats.cuerpo;
            text += ' | Destreza: ' + (stats.destreza >= 0 ? '+' : '') + stats.destreza;
            text += ' | Aura: ' + (stats.aura >= 0 ? '+' : '') + stats.aura + '\n';
            text += 'Iniciativa: ' + (stats.iniciativa >= 0 ? '+' : '') + stats.iniciativa + '\n';
            text += 'Movimiento: ' + stats.movimiento + ' metros\n';
            text += 'Naturaleza: ' + (nature || 'No asignada') + '\n\n';
            
            if (description) {
              text += '## Descripción\n' + description + '\n\n';
            }
            
            if (selectedArmor || selectedShield || weaponEquipment.length > 0) {
              text += '## Equipo\n';
              if (selectedArmor) text += '- ' + selectedArmor.name + ' (Bono: +' + selectedArmor.bonus + ', ' + selectedArmor.properties + ')\n';
              if (selectedShield) text += '- ' + selectedShield.name + ' (Bono: +' + selectedShield.bonus + ', ' + selectedShield.properties + ')\n';
              weaponEquipment.forEach(w => {
                text += '- ' + w.name + ' (Daño: ' + w.damage + ' ' + w.type + ', ' + w.properties + ')\n';
              });
              text += '\n';
            }
            
            if (selectedTraits.length > 0) {
              text += '## Rasgos\n';
              if (concept) text += '**' + concept + ' (Categoría):** ' + 'Concepto de la criatura\n';
              selectedTraits.forEach(trait => {
                const sign = trait.cost > 0 ? '+' : '';
                text += '**' + trait.name + ' (' + sign + trait.cost + ' PR):** ' + trait.desc + '\n';
              });
              text += '\n';
            }
            
            if (customActions.length > 0 || weaponEquipment.length > 0) {
              text += '## Acciones\n';
              
              customActions.forEach(action => {
                if (action.name) {
                  let actionDamage = action.damage;
                  let attackBonus = stats.cuerpo;
                  
                  if (action.damage === 'ND') {
                    actionDamage = stats.danoBase;
                  }
                  
                  text += '**' + action.name + ':** Bono de Ataque +' + attackBonus;
                  text += ', Daño ' + actionDamage;
                  if (attackBonus !== 0 && !actionDamage.includes('+') && !actionDamage.includes('-')) {
                    text += (attackBonus > 0 ? '+' : '') + attackBonus;
                  }
                  text += ' ' + action.type;
                  if (action.properties) text += ' (' + action.properties + ')';
                  text += '\n';
                }
              });
              
              weaponEquipment.forEach(w => {
                const weaponAttr = w.properties.includes('Ligera') ? stats.destreza : stats.cuerpo;
                const attackBonus = weaponAttr;
                text += '**' + w.name + ':** Bono de Ataque +' + attackBonus;
                text += ', Daño ' + w.damage;
                if (weaponAttr !== 0) {
                  text += (weaponAttr > 0 ? '+' : '') + weaponAttr;
                }
                text += ' ' + w.type + '\n';
              });
              text += '\n';
            }
            
            text += '---\n';
            text += 'PR Usados: ' + stats.prUsed + '/' + stats.prBase + ' | Restantes: ' + stats.prRemaining + '\n';
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = (name || 'criatura').replace(/\s+/g, '_') + '.md';
            a.click();
            URL.revokeObjectURL(url);
            
            setNotification('✅ Archivo descargado');
            setTimeout(() => setNotification(null), 3000);
          };

          const stats = calculateStats();

          return (
            <div className="min-h-screen bg-gradient-to-br from-stone-900 via-green-900 to-stone-900 p-4">
              {notification && (
                <div className="fixed top-4 right-4 bg-green-700 text-stone-100 px-6 py-3 rounded-lg shadow-lg z-50 border-2 border-green-500">
                  {notification}
                </div>
              )}
              
              <div className="max-w-7xl mx-auto">
                <header className="text-center mb-8 pt-6">
                  <h1 className="text-5xl font-bold text-green-400 mb-2">Creador de Criaturas</h1>
                  <p className="text-stone-300 text-lg">Sistema PAPA - Nivel de Desafío</p>
                </header>

                <div className="grid lg:grid-cols-3 gap-6">
                  <div className="lg:col-span-2 space-y-6">
                    {/* INFO BÁSICA */}
                    <div className="bg-stone-800 rounded-lg shadow-xl p-6 border-2 border-green-600">
                      <h2 className="text-2xl font-bold text-green-400 mb-4">Información Básica</h2>
                      
                      <div className="space-y-4">
                        <div>
                          <label className="block text-stone-300 mb-2 font-semibold">Nombre *</label>
                          <input
                            type="text"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            placeholder="Ej: Lobo Salvaje"
                            className="w-full px-4 py-2 bg-stone-700 text-stone-100 rounded border-2 border-stone-600 focus:border-green-500 outline-none"
                          />
                        </div>

                        <div className="grid md:grid-cols-3 gap-4">
                          <div>
                            <label className="block text-stone-300 mb-2 font-semibold">ND *</label>
                            <select
                              value={nd}
                              onChange={(e) => setND(e.target.value)}
                              className="w-full px-4 py-2 bg-stone-700 text-stone-100 rounded border-2 border-stone-600 focus:border-green-500 outline-none"
                            >
                              {Object.keys(ndStats).map(level => (
                                <option key={level} value={level}>ND {level}</option>
                              ))}
                            </select>
                          </div>
                          
                          <div>
                            <label className="block text-stone-300 mb-2 font-semibold">Tamaño *</label>
                            <select
                              value={size}
                              onChange={(e) => setSize(e.target.value)}
                              className="w-full px-4 py-2 bg-stone-700 text-stone-100 rounded border-2 border-stone-600 focus:border-green-500 outline-none"
                            >
                              {Object.keys(sizeModifiers).map(s => (
                                <option key={s} value={s}>{sizeModifiers[s].label}</option>
                              ))}
                            </select>
                          </div>
                          
                          <div>
                            <label className="block text-stone-300 mb-2 font-semibold">Categoría *</label>
                            <select
                              value={category}
                              onChange={(e) => setCategory(e.target.value)}
                              className="w-full px-4 py-2 bg-stone-700 text-stone-100 rounded border-2 border-stone-600 focus:border-green-500 outline-none"
                            >
                              <option value="bestias">Bestias</option>
                              <option value="monstruos">Monstruos</option>
                              <option value="espiritus">Espíritus</option>
                              <option value="exaltados">Exaltados</option>
                              <option value="corruptos">Corruptos</option>
                              <option value="elementales">Elementales</option>
                              <option value="artificiales">Artificiales</option>
                              <option value="npc">NPC</option>
                            </select>
                          </div>
                        </div>

                        <div>
                          <label className="block text-stone-300 mb-2 font-semibold">Etiqueta</label>
                          <input
                            type="text"
                            value={tag}
                            onChange={(e) => setTag(e.target.value)}
                            placeholder="Ej: Insecto, Dragón"
                            className="w-full px-4 py-2 bg-stone-700 text-stone-100 rounded border-2 border-stone-600 focus:border-green-500 outline-none"
                          />
                        </div>

                        <div className="grid md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-stone-300 mb-2 font-semibold">Concepto</label>
                            <input
                              type="text"
                              value={concept}
                              onChange={(e) => setConcept(e.target.value)}
                              placeholder="Por defecto: categoría"
                              className="w-full px-4 py-2 bg-stone-700 text-stone-100 rounded border-2 border-stone-600 focus:border-green-500 outline-none"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-stone-300 mb-2 font-semibold">Naturaleza</label>
                            <select
                              value={nature}
                              onChange={(e) => setNature(e.target.value)}
                              className="w-full px-4 py-2 bg-stone-700 text-stone-100 rounded border-2 border-stone-600 focus:border-green-500 outline-none"
                            >
                              <option value="">Seleccionar...</option>
                              {naturalezas.map(nat => (
                                <option key={nat} value={nat}>{nat}</option>
                              ))}
                            </select>
                          </div>
                        </div>
                        
                        <div>
                          <label className="block text-stone-300 mb-2 font-semibold">Descripción</label>
                          <textarea
                            value={description}
                            onChange={(e) => setDescription(e.target.value)}
                            placeholder="Describe la criatura..."
                            rows="2"
                            className="w-full px-4 py-2 bg-stone-700 text-stone-100 rounded border-2 border-stone-600 focus:border-green-500 outline-none resize-none"
                          />
                        </div>
                      </div>
                    </div>

                    {/* ACCIONES PERSONALIZADAS */}
                    <div className="bg-stone-800 rounded-lg shadow-xl p-6 border-2 border-green-600">
                      <h2 className="text-2xl font-bold text-green-400 mb-4">Acciones Personalizadas</h2>
                      <p className="text-stone-300 text-sm mb-4">
                        Define los ataques y acciones especiales de la criatura. Usa "ND" como daño para aplicar el daño base del Nivel de Desafío.
                      </p>
                      
                      <div className="space-y-3 mb-4">
                        {customActions.map(action => (
                          <div key={action.id} className="p-3 bg-stone-700 rounded border-2 border-stone-600">
                            <div className="grid gap-2">
                              <div>
                                <label className="block text-stone-300 text-xs mb-1">Nombre</label>
                                <input
                                  type="text"
                                  value={action.name}
                                  onChange={(e) => updateCustomAction(action.id, 'name', e.target.value)}
                                  placeholder="Ej: Mordisco"
                                  className="w-full px-2 py-1 bg-stone-600 text-stone-100 rounded border border-stone-500 focus:border-green-500 outline-none text-sm"
                                />
                              </div>
                              <div className="grid grid-cols-3 gap-2">
                                <div>
                                  <label className="block text-stone-300 text-xs mb-1">Daño</label>
                                  <input
                                    type="text"
                                    value={action.damage}
                                    onChange={(e) => updateCustomAction(action.id, 'damage', e.target.value)}
                                    placeholder="ND o 2d6"
                                    className="w-full px-2 py-1 bg-stone-600 text-stone-100 rounded border border-stone-500 focus:border-green-500 outline-none text-sm"
                                  />
                                </div>
                                <div>
                                  <label className="block text-stone-300 text-xs mb-1">Tipo</label>
                                  <select
                                    value={action.type}
                                    onChange={(e) => updateCustomAction(action.id, 'type', e.target.value)}
                                    className="w-full px-2 py-1 bg-stone-600 text-stone-100 rounded border border-stone-500 focus:border-green-500 outline-none text-sm"
                                  >
                                    <option>Contundente</option>
                                    <option>Cortante</option>
                                    <option>Penetrante</option>
                                    <option>Fuego</option>
                                    <option>Hielo</option>
                                    <option>Eléctrico</option>
                                    <option>Corrosivo</option>
                                    <option>Radiante</option>
                                    <option>Mental</option>
                                  </select>
                                </div>
                                <div className="flex items-end">
                                  {!action.isNatural && (
                                    <button
                                      onClick={() => removeCustomAction(action.id)}
                                      className="w-full px-2 py-1 bg-red-700 hover:bg-red-800 text-stone-100 rounded text-sm"
                                    >
                                      ×
                                    </button>
                                  )}
                                </div>
                              </div>
                              <div>
                                <label className="block text-stone-300 text-xs mb-1">Propiedades</label>
                                <input
                                  type="text"
                                  value={action.properties}
                                  onChange={(e) => updateCustomAction(action.id, 'properties', e.target.value)}
                                  placeholder="Ej: Alcance 3m, Área 5m"
                                  className="w-full px-2 py-1 bg-stone-600 text-stone-100 rounded border border-stone-500 focus:border-green-500 outline-none text-sm"
                                />
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                      
                      <button
                        onClick={addCustomAction}
                        className="w-full py-2 bg-green-700 hover:bg-green-800 text-stone-100 rounded font-semibold transition-colors"
                      >
                        + Agregar Acción
                      </button>
                    </div>

                    {/* AJUSTE DE ATRIBUTOS */}
                    <div className="bg-stone-800 rounded-lg shadow-xl p-6 border-2 border-lime-600">
                      <h2 className="text-2xl font-bold text-lime-400 mb-4">Ajuste de Atributos</h2>
                      <p className="text-stone-300 text-sm mb-4">
                        Aumentar: +2 PR por punto | Disminuir: -1 PR por punto (mín. -3)
                      </p>
                      
                      <div className="space-y-4">
                        <div>
                          <label className="block text-stone-300 mb-2 font-semibold">
                            Cuerpo (Base: +{ndStats[nd].atributos})
                          </label>
                          <div className="flex items-center gap-2">
                            <button
                              onClick={() => setCuerpoMod(Math.max(cuerpoMod - 1, -ndStats[nd].atributos - 3))}
                              className="px-3 py-2 bg-red-700 hover:bg-red-800 text-stone-100 rounded font-bold"
                            >
                              −
                            </button>
                            <div className="flex-1 text-center bg-stone-700 py-2 rounded text-stone-100 font-bold">
                              {cuerpoMod >= 0 ? '+' : ''}{cuerpoMod} ({cuerpoMod * 2} PR)
                            </div>
                            <button
                              onClick={() => setCuerpoMod(cuerpoMod + 1)}
                              className="px-3 py-2 bg-lime-700 hover:bg-lime-800 text-stone-100 rounded font-bold"
                            >
                              +
                            </button>
                          </div>
                        </div>

                        <div>
                          <label className="block text-stone-300 mb-2 font-semibold">
                            Destreza (Base: +{ndStats[nd].atributos})
                          </label>
                          <div className="flex items-center gap-2">
                            <button
                              onClick={() => setDestrezaMod(Math.max(destrezaMod - 1, -ndStats[nd].atributos - 3))}
                              className="px-3 py-2 bg-red-700 hover:bg-red-800 text-stone-100 rounded font-bold"
                            >
                              −
                            </button>
                            <div className="flex-1 text-center bg-stone-700 py-2 rounded text-stone-100 font-bold">
                              {destrezaMod >= 0 ? '+' : ''}{destrezaMod} ({destrezaMod * 2} PR)
                            </div>
                            <button
                              onClick={() => setDestrezaMod(destrezaMod + 1)}
                              className="px-3 py-2 bg-lime-700 hover:bg-lime-800 text-stone-100 rounded font-bold"
                            >
                              +
                            </button>
                          </div>
                        </div>

                        <div>
                          <label className="block text-stone-300 mb-2 font-semibold">
                            Aura (Base: +{ndStats[nd].atributos})
                          </label>
                          <div className="flex items-center gap-2">
                            <button
                              onClick={() => setAuraMod(Math.max(auraMod - 1, -ndStats[nd].atributos - 3))}
                              className="px-3 py-2 bg-red-700 hover:bg-red-800 text-stone-100 rounded font-bold"
                            >
                              −
                            </button>
                            <div className="flex-1 text-center bg-stone-700 py-2 rounded text-stone-100 font-bold">
                              {auraMod >= 0 ? '+' : ''}{auraMod} ({auraMod * 2} PR)
                            </div>
                            <button
                              onClick={() => setAuraMod(auraMod + 1)}
                              className="px-3 py-2 bg-lime-700 hover:bg-lime-800 text-stone-100 rounded font-bold"
                            >
                              +
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* EQUIPO */}
                    <div className="bg-stone-800 rounded-lg shadow-xl p-6 border-2 border-amber-700">
                      <h2 className="text-2xl font-bold text-amber-400 mb-4">Equipo</h2>
                      
                      <div className="space-y-2 mb-4">
                        <div className="border border-stone-700 rounded-lg overflow-hidden">
                          <button
                            onClick={() => setOpenEquipmentCategory(openEquipmentCategory === 'weapons' ? null : 'weapons')}
                            className="w-full px-4 py-3 bg-stone-700 hover:bg-stone-600 text-left font-semibold text-stone-100 flex justify-between items-center transition-colors"
                          >
                            <span>Armas</span>
                            <span className="text-xl">{openEquipmentCategory === 'weapons' ? '−' : '+'}</span>
                          </button>
                          
                          {openEquipmentCategory === 'weapons' && (
                            <div className="p-3 bg-stone-750 space-y-2 max-h-60 overflow-y-auto">
                              {Object.entries(weapons).map(([catName, catWeapons]) => (
                                <div key={catName}>
                                  <div className="text-amber-300 font-semibold text-sm mb-1">{catName}</div>
                                  {catWeapons.map((weapon, idx) => (
                                    <button
                                      key={idx}
                                      onClick={() => addEquipment(weapon, 'weapon')}
                                      className="w-full text-left p-2 bg-stone-700 hover:bg-amber-900 rounded border border-amber-600 transition-colors text-sm mb-1"
                                    >
                                      <div className="font-semibold text-amber-200">{weapon.name}</div>
                                      <div className="text-stone-400 text-xs">{weapon.damage} {weapon.type}</div>
                                    </button>
                                  ))}
                                </div>
                              ))}
                            </div>
                          )}
                        </div>

                        <div className="border border-stone-700 rounded-lg overflow-hidden">
                          <button
                            onClick={() => setOpenEquipmentCategory(openEquipmentCategory === 'armor' ? null : 'armor')}
                            className="w-full px-4 py-3 bg-stone-700 hover:bg-stone-600 text-left font-semibold text-stone-100 flex justify-between items-center transition-colors"
                          >
                            <span>Armaduras</span>
                            <span className="text-xl">{openEquipmentCategory === 'armor' ? '−' : '+'}</span>
                          </button>
                          
                          {openEquipmentCategory === 'armor' && (
                            <div className="p-3 bg-stone-750 space-y-2 max-h-60 overflow-y-auto">
                              {armors.map((armor, idx) => (
                                <button
                                  key={idx}
                                  onClick={() => {
                                    setEquipment(equipment.filter(e => e.type !== 'armor'));
                                    if (armor.bonus > 0) addEquipment(armor, 'armor');
                                  }}
                                  className="w-full text-left p-2 bg-stone-700 hover:bg-amber-900 rounded border border-amber-600 transition-colors text-sm"
                                >
                                  <div className="font-semibold text-amber-200">{armor.name}</div>
                                  <div className="text-stone-400 text-xs">Bono: +{armor.bonus}</div>
                                </button>
                              ))}
                            </div>
                          )}
                        </div>

                        <div className="border border-stone-700 rounded-lg overflow-hidden">
                          <button
                            onClick={() => setOpenEquipmentCategory(openEquipmentCategory === 'shields' ? null : 'shields')}
                            className="w-full px-4 py-3 bg-stone-700 hover:bg-stone-600 text-left font-semibold text-stone-100 flex justify-between items-center transition-colors"
                          >
                            <span>Escudos</span>
                            <span className="text-xl">{openEquipmentCategory === 'shields' ? '−' : '+'}</span>
                          </button>
                          
                          {openEquipmentCategory === 'shields' && (
                            <div className="p-3 bg-stone-750 space-y-2 max-h-60 overflow-y-auto">
                              {shields.map((shield, idx) => (
                                <button
                                  key={idx}
                                  onClick={() => {
                                    setEquipment(equipment.filter(e => e.type !== 'shield'));
                                    if (shield.bonus > 0) addEquipment(shield, 'shield');
                                  }}
                                  className="w-full text-left p-2 bg-stone-700 hover:bg-amber-900 rounded border border-amber-600 transition-colors text-sm"
                                >
                                  <div className="font-semibold text-amber-200">{shield.name}</div>
                                  <div className="text-stone-400 text-xs">Bono: +{shield.bonus}</div>
                                </button>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      <div className="space-y-2">
                        {equipment.map(item => (
                          <div key={item.id} className="p-2 bg-stone-700 rounded flex justify-between items-center">
                            <div>
                              <div className="font-semibold text-stone-100 text-sm">{item.name}</div>
                              <div className="text-xs text-stone-400">
                                {item.type === 'weapon' ? `${item.damage} ${item.type}` : `Bono: +${item.bonus}`}
                              </div>
                            </div>
                            <button
                              onClick={() => removeEquipment(item.id)}
                              className="text-red-400 hover:text-red-300 ml-2 text-xl"
                            >
                              ×
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* BIBLIOTECA DE RASGOS */}
                    <div className="bg-stone-800 rounded-lg shadow-xl p-6 border-2 border-emerald-600">
                      <h2 className="text-2xl font-bold text-emerald-400 mb-4">Biblioteca de Rasgos</h2>
                      
                      <div className="space-y-2">
                        {Object.entries(traits).map(([catName, catTraits]) => (
                          <div key={catName} className="border border-stone-700 rounded-lg overflow-hidden">
                            <button
                              onClick={() => setOpenCategory(openCategory === catName ? null : catName)}
                              className="w-full px-4 py-3 bg-stone-700 hover:bg-stone-600 text-left font-semibold text-stone-100 flex justify-between items-center transition-colors"
                            >
                              <span>{catName}</span>
                              <span className="text-xl">{openCategory === catName ? '−' : '+'}</span>
                            </button>
                            
                            {openCategory === catName && (
                              <div className="p-3 bg-stone-750 space-y-2 max-h-80 overflow-y-auto">
                                {catTraits.map((trait, idx) => (
                                  <button
                                    key={idx}
                                    onClick={() => addTrait(trait)}
                                    className="w-full text-left p-3 bg-stone-700 hover:bg-emerald-900 rounded border border-emerald-600 transition-colors"
                                  >
                                    <div className="flex justify-between items-start">
                                      <div className="flex-1">
                                        <div className="font-semibold text-emerald-200">{trait.name}</div>
                                        <div className="text-sm text-stone-400 mt-1">{trait.desc}</div>
                                      </div>
                                      <div className="ml-2 text-emerald-300 font-bold">
                                        {trait.cost > 0 ? '+' : ''}{trait.cost}
                                      </div>
                                    </div>
                                  </button>
                                ))}
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* PANEL LATERAL */}
                  <div className="space-y-6">
                    <div className="bg-stone-800 rounded-lg shadow-xl p-6 border-2 border-green-600 sticky top-4">
                      <h2 className="text-2xl font-bold text-green-400 mb-4">Estadísticas</h2>
                      
                      <div className="space-y-3 mb-4">
                        <div className="p-3 bg-stone-700 rounded">
                          <div className="text-stone-400 text-sm">Resistencia</div>
                          <div className="text-2xl font-bold text-stone-100">{stats.resistencia}</div>
                        </div>
                        
                        <div className="grid grid-cols-2 gap-3">
                          <div className="p-3 bg-stone-700 rounded">
                            <div className="text-stone-400 text-sm">Defensa</div>
                            <div className="text-xl font-bold text-stone-100">{stats.defensa}</div>
                          </div>
                          <div className="p-3 bg-stone-700 rounded">
                            <div className="text-stone-400 text-sm">Iniciativa</div>
                            <div className="text-xl font-bold text-stone-100">{stats.iniciativa >= 0 ? '+' : ''}{stats.iniciativa}</div>
                          </div>
                        </div>

                        <div className="p-3 bg-stone-700 rounded">
                          <div className="text-stone-400 text-sm">Movimiento</div>
                          <div className="text-xl font-bold text-stone-100">{stats.movimiento}m</div>
                        </div>
                        
                        <div className="grid grid-cols-3 gap-2">
                          <div className="p-2 bg-stone-700 rounded">
                            <div className="text-stone-400 text-xs">Cuerpo</div>
                            <div className="text-lg font-bold text-stone-100">{stats.cuerpo >= 0 ? '+' : ''}{stats.cuerpo}</div>
                          </div>
                          <div className="p-2 bg-stone-700 rounded">
                            <div className="text-stone-400 text-xs">Destreza</div>
                            <div className="text-lg font-bold text-stone-100">{stats.destreza >= 0 ? '+' : ''}{stats.destreza}</div>
                          </div>
                          <div className="p-2 bg-stone-700 rounded">
                            <div className="text-stone-400 text-xs">Aura</div>
                            <div className="text-lg font-bold text-stone-100">{stats.aura >= 0 ? '+' : ''}{stats.aura}</div>
                          </div>
                        </div>
                        
                        <div className="p-3 rounded" style={{backgroundColor: stats.prRemaining >= 0 ? '#14532d' : '#7f1d1d'}}>
                          <div className="text-stone-300 text-sm">Puntos de Rasgo</div>
                          <div className="text-2xl font-bold text-stone-100">
                            {stats.prUsed} / {stats.prBase}
                          </div>
                          <div className="text-sm mt-1" style={{color: stats.prRemaining >= 0 ? '#86efac' : '#fca5a5'}}>
                            Restantes: {stats.prRemaining}
                          </div>
                        </div>
                      </div>

                      <div className="space-y-3 mb-4 max-h-64 overflow-y-auto">
                        {selectedTraits.map(trait => (
                          <div key={trait.id} className="p-3 bg-stone-700 rounded">
                            <div className="flex justify-between items-start mb-1">
                              <div className="font-semibold text-stone-100 text-sm">{trait.name}</div>
                              <button
                                onClick={() => removeTrait(trait.id)}
                                className="text-red-400 hover:text-red-300 ml-2 text-xl"
                              >
                                ×
                              </button>
                            </div>
                            <div className="text-xs text-stone-400">{trait.desc}</div>
                            <div className="text-xs mt-1" style={{color: trait.cost > 0 ? '#86efac' : '#fca5a5'}}>
                              {trait.cost > 0 ? '+' : ''}{trait.cost} PR
                            </div>
                          </div>
                        ))}
                      </div>

                      <button
                        onClick={exportAsText}
                        disabled={!name}
                        className="w-full py-3 bg-green-700 hover:bg-green-800 disabled:bg-stone-600 disabled:cursor-not-allowed text-stone-100 rounded font-semibold transition-colors"
                      >
                        📄 Exportar como Markdown
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CreatureCreator />);
    </script>
</body>
</html>

